<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life RPG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0c1017; color: #f0f6fc; }
        .prosto-card { background-color: #161b22; border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 1.5rem; }
        .prosto-btn { background-color: #2563eb; color: white; border-radius: 1rem; transition: all 0.2s ease; }
        .nav-active { color: #3b82f6; }
        .btn-loading { opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body class="p-4 pb-28">

    <div id="splash-screen" class="fixed inset-0 bg-[#0c1017] z-[9999] flex flex-col items-center justify-center">
        <div class="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center animate-bounce mb-6">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
        </div>
        <p id="loading-status" class="text-blue-500 font-semibold text-sm animate-pulse uppercase tracking-widest">–°–≤—è–∑—å —Å —Å–µ—Ä–≤–µ—Ä–æ–º...</p>
    </div>

    <div class="flex justify-between items-center mb-8 pt-2">
        <div class="flex items-center gap-3">
            <div id="avatar" class="w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center font-bold text-xl"></div>
            <div>
                <h1 id="user-name" class="text-lg font-bold">...</h1>
                <div class="flex items-center gap-2">
                    <p class="text-xs text-gray-400 font-semibold">XP: <span id="total-xp" class="text-white">0</span></p>
                    <div id="streak-badge" class="hidden items-center bg-orange-500/10 px-2 py-0.5 rounded-full border border-orange-500/20">
                        <span class="text-[10px]">üî•</span>
                        <span id="streak-count" class="text-[10px] text-orange-500 font-black ml-1">0</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-right">
            <div class="text-[10px] text-gray-400 font-bold uppercase mb-1">–ó–¥–æ—Ä–æ–≤—å–µ <span id="hp-val">100</span>%</div>
            <div class="w-24 bg-gray-800 h-1.5 rounded-full overflow-hidden"><div id="hp-bar" class="bg-blue-500 h-full w-full"></div></div>
        </div>
    </div>

    <div class="space-y-6">
        <div class="prosto-card p-6 text-center">
            <p class="text-gray-400 text-[10px] font-bold uppercase tracking-widest mb-1">–û—á–∫–æ–≤ –≤ –º–µ—Å—è—Ü–µ</p>
            <h2 id="month-xp" class="text-5xl font-black text-white">0</h2>
        </div>

        <div class="prosto-card p-5">
            <div class="flex justify-between items-center mb-4">
                <div class="font-bold text-sm uppercase text-blue-400 tracking-wider">–í–æ–¥–Ω—ã–π –±–∞–ª–∞–Ω—Å</div>
                <div class="text-xs font-bold" id="water-count">0 / 8 —Å—Ç.</div>
            </div>
            <button onclick="drinkWater(this)" class="w-full prosto-btn p-4 font-bold text-sm shadow-lg shadow-blue-900/20 active:scale-95 transition-all">–í–´–ü–ò–¢–¨ –°–¢–ê–ö–ê–ù üíß</button>
        </div>
    </div>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] bg-[#161b22]/90 backdrop-blur-md border border-gray-800 rounded-2xl p-4 flex justify-around shadow-2xl">
        <div class="text-blue-500 font-bold text-[10px] uppercase">–ü—É—Ç—å</div>
        <div class="text-gray-500 font-bold text-[10px] uppercase opacity-50">–ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="text-gray-500 font-bold text-[10px] uppercase opacity-50">–ñ—É—Ä–Ω–∞–ª</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const backendUrl = "https://rpg-backend-yg16.onrender.com";
        const userId = tg.initDataUnsafe?.user?.id.toString() || "guest";
        const firstName = tg.initDataUnsafe?.user?.first_name || "–ì–µ—Ä–æ–π";

        document.getElementById('user-name').textContent = firstName;
        document.getElementById('avatar').textContent = firstName[0];

        async function loadHero() {
            try {
                const response = await fetch(`${backendUrl}/get_hero/${userId}`, {
                    headers: { 'X-TG-Data': tg.initData || "" }
                });
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                const data = await response.json();
                updateUI(data);
            } catch (e) {
                document.getElementById('loading-status').textContent = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ.";
                document.getElementById('loading-status').classList.remove('text-blue-500');
                document.getElementById('loading-status').classList.add('text-red-500');
            }
        }

        function updateUI(data) {
            document.getElementById('total-xp').textContent = data.total_xp;
            document.getElementById('month-xp').textContent = data.current_month_xp;
            document.getElementById('water-count').textContent = `${data.water_count} / ${data.water_goal} —Å—Ç.`;
            document.getElementById('hp-val').textContent = data.hp;
            document.getElementById('hp-bar').style.width = data.hp + '%';

            if (data.streak > 0) {
                document.getElementById('streak-badge').classList.replace('hidden', 'flex');
                document.getElementById('streak-count').textContent = data.streak;
            }

            document.getElementById('splash-screen').style.display = 'none';
        }

        async function drinkWater(btn) {
            btn.classList.add('btn-loading');
            try {
                const response = await fetch(`${backendUrl}/drink_water/${userId}`, {
                    method: 'POST',
                    headers: { 'X-TG-Data': tg.initData || "" }
                });
                if (response.ok) updateUI(await response.json());
                else tg.showAlert("–û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑ Telegram");
            } catch(e) { tg.showAlert("–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º"); }
            finally { btn.classList.remove('btn-loading'); }
        }

        loadHero();
    </script>
</body>
</html>
