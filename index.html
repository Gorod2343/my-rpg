<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Life RPG</title>
<script src="https://cdn.tailwindcss.com"></script><script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
body{font-family:'Inter',sans-serif;background:#0c1017;color:#f0f6fc;padding:1rem;padding-bottom:7rem}
.prosto-card{background:#161b22;border:1px solid rgba(255,255,255,0.05);border-radius:1.5rem}
.prosto-btn{background:#2563eb;color:#fff;border-radius:1rem;transition:all .2s;width:100%;font-weight:700}
.nav-active{color:#3b82f6;background:rgba(255,255,255,0.05)}
.btn-loading{opacity:.6;pointer-events:none}.done-task{opacity:.4;pointer-events:none}
.sleep-active{background:#1e3a8a!important;animation:pulse 2s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(37,99,235,0.4)}70%{box-shadow:0 0 0 10px rgba(37,99,235,0)}100%{box-shadow:0 0 0 0 rgba(37,99,235,0)}}
.accordion-content{overflow:hidden;transition:max-height .4s ease-in-out;max-height:0}
.chevron{transition:transform .3s}.rotate-180{transform:rotate(180deg)}
#splash-screen{position:fixed;inset:0;background:#0c1017;z-index:9999;display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>
<div id="splash-screen"><p class="text-blue-500 font-bold animate-pulse uppercase">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</p></div>
<div class="flex justify-between items-center mb-8"><div class="flex items-center gap-3"><div id="avatar" class="w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center font-bold text-xl">–ê</div><div><h1 id="user-name" class="text-lg font-bold leading-tight">...</h1><div class="flex items-center gap-2 mt-0.5"><p class="text-xs text-gray-400">XP: <span id="total-xp" class="text-white">0</span></p><div id="streak-badge" class="hidden items-center bg-orange-500/10 px-1.5 py-0.5 rounded-full border border-orange-500/20">üî•<span id="streak-count" class="text-[10px] text-orange-500 font-black ml-0.5">0</span></div></div></div></div><div class="text-right"><div class="text-[10px] text-gray-400 font-bold uppercase">HP <span id="user-hp">100</span>%</div><div class="w-24 bg-[#161b22] h-1.5 rounded-full overflow-hidden mt-1"><div id="hp-bar" class="bg-blue-500 h-full w-full"></div></div></div></div>
<div id="tab-tasks" class="tab-content space-y-4">
<div class="prosto-card p-6 text-center"><p class="text-gray-400 text-[10px] uppercase font-bold">–û—á–∫–æ–≤ –≤ –º–µ—Å—è—Ü–µ</p><h2 id="month-xp" class="text-5xl font-black">0</h2></div>
<div class="prosto-card p-5"><div class="flex justify-between items-center mb-4"><span class="text-indigo-400 text-[10px] font-bold uppercase">–°–æ–Ω (AASM)</span><span class="text-xs font-bold text-gray-400">+ –¥–æ 100 XP</span></div><button id="btn-sleep" onclick="toggleSleep()" class="prosto-btn p-4">–ù–ê–ß–ê–¢–¨ –¢–†–ï–ö–ò–ù–ì üåô</button><p id="sleep-status" class="text-[10px] text-gray-500 text-center mt-2 hidden"></p></div>
<div class="prosto-card p-5"><div class="flex justify-between items-center mb-4"><span class="text-blue-400 text-[10px] font-bold uppercase">–í–æ–¥–∞</span><span id="water-text" class="text-xs font-bold text-gray-400">0/8 —Å—Ç.</span></div><button onclick="drinkWater(this)" class="prosto-btn p-4 active:scale-95">–ü–ò–¢–¨ –°–¢–ê–ö–ê–ù üíß</button><div class="w-full bg-[#0c1017] h-1.5 rounded-full mt-4 overflow-hidden"><div id="water-progress" class="bg-blue-500 h-full w-0 transition-all duration-300"></div></div></div>
<div class="prosto-card overflow-hidden"><button onclick="toggleAccordion('acc-sport','icon-sport')" class="w-full p-5 flex justify-between items-center"><span class="font-bold">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span><svg id="icon-sport" class="w-5 h-5 chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div id="acc-sport" class="accordion-content bg-[#0c1017]/30 border-t border-gray-800/50"><div id="list-sport" class="p-2 space-y-1"></div></div></div>
<div class="prosto-card overflow-hidden"><button onclick="toggleAccordion('acc-family','icon-family')" class="w-full p-5 flex justify-between items-center"><span class="font-bold">–°–µ–º—å—è</span><svg id="icon-family" class="w-5 h-5 chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div id="acc-family" class="accordion-content bg-[#0c1017]/30 border-t border-gray-800/50"><div id="list-family" class="p-2 space-y-1"></div></div></div>
<button onclick="openEditor()" class="w-full text-[10px] text-gray-500 font-bold uppercase underline mt-4">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ø–∏—Å–∫–∏</button></div>
<div id="tab-calc" class="tab-content hidden space-y-4"><h2 class="text-2xl font-black text-center mt-4">–ë–∏–æ–º–µ—Ç—Ä–∏—è</h2><div class="prosto-card p-6 space-y-4"><input type="number" id="calc-height" class="w-full bg-[#0c1017] border border-gray-800 rounded-xl p-4 text-white" placeholder="–†–æ—Å—Ç (—Å–º)"><input type="number" id="calc-weight" class="w-full bg-[#0c1017] border border-gray-800 rounded-xl p-4 text-white" placeholder="–í–µ—Å (–∫–≥)"><div id="bmi-res" class="hidden bg-blue-900/20 p-4 rounded-xl text-sm font-bold text-blue-400"></div><button onclick="applyWaterGoal(this)" class="prosto-btn p-4">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div></div>
<div id="tab-shop" class="tab-content hidden p-4"></div><div id="tab-history" class="tab-content hidden p-4"></div>
<div id="editor-modal" class="fixed inset-0 bg-[#0c1017] z-[10000] p-4 overflow-y-auto hidden">
<div class="flex justify-between items-center mb-6"><h2 class="text-xl font-bold">–†–µ–¥–∞–∫—Ç–æ—Ä</h2><button onclick="closeEditor()" class="text-gray-400 font-bold uppercase text-xs">–ó–∞–∫—Ä—ã—Ç—å</button></div>
<div class="prosto-card p-5 mb-6 space-y-3"><input type="text" id="new-h-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="w-full bg-[#0c1017] border border-gray-800 rounded-xl p-3 text-white"><div class="grid grid-cols-2 gap-3"><select id="new-h-cat" class="w-full bg-[#0c1017] border border-gray-800 rounded-xl p-3 text-white"><option value="sport">–°–ø–æ—Ä—Ç</option><option value="family">–°–µ–º—å—è</option></select><input type="number" id="new-h-xp" placeholder="XP" class="w-full bg-[#0c1017] border border-gray-800 rounded-xl p-3 text-white"></div><button id="add-btn" onclick="addNewHabit()" class="prosto-btn p-3">–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫</button></div>
<div id="editor-list" class="space-y-2 mb-20"></div><button onclick="saveHabitsToServer(this)" class="prosto-btn p-4 bg-blue-600 fixed bottom-6 left-4 right-4 max-w-md mx-auto shadow-2xl">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è</button></div>
<nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-md bg-[#161b22]/95 backdrop-blur-xl border border-gray-800 rounded-[2rem] p-2 flex justify-around shadow-2xl z-50">
<button onclick="showTab('tasks')" id="nav-tasks" class="flex-1 py-3 rounded-2xl nav-active text-[9px] font-black uppercase">–ü—É—Ç—å</button><button onclick="showTab('calc')" id="nav-calc" class="flex-1 py-3 rounded-2xl text-gray-500 text-[9px] font-black uppercase">–ë–∏–æ</button><button onclick="showTab('shop')" id="nav-shop" class="flex-1 py-3 rounded-2xl text-gray-500 text-[9px] font-black uppercase">–ú–∞–≥</button><button onclick="showTab('history')" id="nav-history" class="flex-1 py-3 rounded-2xl text-gray-500 text-[9px] font-black uppercase">–ñ—É—Ä</button></nav>
<script>
const tg=window.Telegram.WebApp;tg.expand();const backendUrl="https://rpg-backend-yg16.onrender.com";const userId=tg.initDataUnsafe?.user?.id.toString()||"guest_123";const firstName=tg.initDataUnsafe?.user?.first_name||"–ê–ª–µ–∫—Å–∞–Ω–¥—Ä";
const reqHeaders={'Content-Type':'application/json','X-TG-Data':tg.initData||""};let currentHabits=[],completedTasksArray=[],editingId=null;
document.getElementById('user-name').textContent=firstName;document.getElementById('avatar').textContent=firstName[0];
async function applyWaterGoal(btn){const w=document.getElementById('calc-weight').value;if(w>0){btn.classList.add('btn-loading');const g=Math.ceil((w*40)/250);const r=await fetch(`${backendUrl}/set_water_goal/${userId}?goal=${g}`,{method:'POST',headers:reqHeaders});if(r.ok){const d=await r.json();document.getElementById('bmi-res').classList.remove('hidden');document.getElementById('bmi-res').textContent=`–¶–µ–ª—å: ${g} —Å—Ç.`;updateUI(d);tg.showAlert(`–¶–µ–ª—å ${g} —Å—Ç. —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!`);}btn.classList.remove('btn-loading');}}
function updateUI(d){document.getElementById('total-xp').textContent=d.total_xp;document.getElementById('month-xp').textContent=d.current_month_xp;document.getElementById('user-hp').textContent=d.hp;document.getElementById('hp-bar').style.width=d.hp+'%';document.getElementById('water-text').textContent=`${d.water_count}/${d.water_goal} —Å—Ç.`;document.getElementById('water-progress').style.width=Math.min((d.water_count/d.water_goal*100),100)+'%';if(d.streak>0){document.getElementById('streak-badge').classList.replace('hidden','flex');document.getElementById('streak-count').textContent=d.streak;}
const sBtn=document.getElementById('btn-sleep'),sSt=document.getElementById('sleep-status');if(d.sleep_start){sBtn.textContent='–ü–†–û–°–ù–£–¢–¨–°–Ø ‚òÄÔ∏è';sBtn.classList.add('sleep-active');sSt.classList.remove('hidden');const date=new Date(d.sleep_start);sSt.textContent=`–°–æ–Ω –∏–¥–µ—Ç —Å ${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;}else{sBtn.textContent='–ù–ê–ß–ê–¢–¨ –¢–†–ï–ö–ò–ù–ì üåô';sBtn.classList.remove('sleep-active');sSt.classList.add('hidden');}
completedTasksArray=d.completed_tasks?d.completed_tasks.split(','):[];currentHabits=d.custom_habits?JSON.parse(d.custom_habits):[{id:'task-run',cat:'sport',name:'–ü—Ä–æ–±–µ–∂–∫–∞',xp:150},{id:'task-strength',cat:'sport',name:'–°–∏–ª–æ–≤–∞—è',xp:200},{id:'task-family',cat:'family',name:'–í—Ä–µ–º—è —Å —Å–µ–º—å–µ–π',xp:100}];renderHabits();document.getElementById('splash-screen').style.display='none';}
function renderHabits(){const s=document.getElementById('list-sport'),f=document.getElementById('list-family'),e=document.getElementById('editor-list');s.innerHTML=f.innerHTML=e.innerHTML='';currentHabits.forEach(h=>{const done=completedTasksArray.includes(h.id);const html=`<button onclick="addXP(${h.xp},'${h.id}','${h.name}',this)" class="w-full text-left flex items-center gap-4 p-4 rounded-xl ${done?'done-task':'hover:bg-white/5'}" ${done?'disabled':''}><div class="w-5 h-5 rounded-full border-2 ${done?'bg-blue-600 border-blue-600':'border-gray-600'} flex items-center justify-center text-[10px]">${done?'‚úì':''}</div><div class="flex-1 font-bold text-sm text-white">${h.name}</div><div class="text-blue-400 font-black text-xs">+${h.xp}</div></button>`;if(h.cat==='sport')s.innerHTML+=html;else f.innerHTML+=html;e.innerHTML+=`<div class="prosto-card p-3 flex justify-between items-center mb-2"><div class="text-sm font-bold">${h.name} <span class="text-blue-400 text-xs">+${h.xp}</span></div><div class="flex gap-2"><button onclick="editHabit('${h.id}')" class="text-blue-400 text-[10px] font-black uppercase">–ò–∑–º.</button><button onclick="removeHabit('${h.id}')" class="text-red-500 text-[10px] font-black uppercase">–£–¥–∞–ª–∏—Ç—å</button></div></div>`;});}
function editHabit(id){const h=currentHabits.find(x=>x.id===id);if(h){document.getElementById('new-h-name').value=h.name;document.getElementById('new-h-cat').value=h.cat;document.getElementById('new-h-xp').value=h.xp;editingId=id;document.getElementById('add-btn').textContent='–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É';}}
function addNewHabit(){const n=document.getElementById('new-h-name').value,c=document.getElementById('new-h-cat').value,x=parseInt(document.getElementById('new-h-xp').value);if(n&&x){if(editingId){const i=currentHabits.findIndex(h=>h.id===editingId);currentHabits[i]={...currentHabits[i],name:n,cat:c,xp:x};editingId=null;document.getElementById('add-btn').textContent='–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫';}else{currentHabits.push({id:'task-custom-'+Date.now(),cat:c,name:n,xp:x});}document.getElementById('new-h-name').value='';document.getElementById('new-h-xp').value='';renderHabits();}}
function removeHabit(id){currentHabits=currentHabits.filter(h=>h.id!==id);renderHabits();}
async function saveHabitsToServer(btn){btn.classList.add('btn-loading');await fetch(`${backendUrl}/update_habits/${userId}`,{method:'POST',headers:reqHeaders,body:JSON.stringify({habits:JSON.stringify(currentHabits)})});closeEditor();loadHero();btn.classList.remove('btn-loading');}
async function toggleSleep(){const btn=document.getElementById('btn-sleep');btn.classList.add('btn-loading');const tz=new Date().getTimezoneOffset();const r=await fetch(`${backendUrl}/sleep_action/${userId}?tz=${tz}`,{method:'POST',headers:reqHeaders});const data=await r.json();updateUI(data);if(data.sleep_report)tg.showAlert(data.sleep_report);btn.classList.remove('btn-loading');}
async function loadHero(){try{const r=await fetch(`${backendUrl}/get_hero/${userId}`,{headers:reqHeaders});if(r.ok)updateUI(await r.json());}catch(e){}}
async function drinkWater(btn){btn.classList.add('btn-loading');const r=await fetch(`${backendUrl}/drink_water/${userId}`,{method:'POST',headers:reqHeaders});if(r.ok)updateUI(await r.json());btn.classList.remove('btn-loading');}
async function addXP(a,i,n,btn){btn.classList.add('btn-loading');const r=await fetch(`${backendUrl}/add_xp/${userId}?amount=${a}&task_id=${i}&task_name=${n}`,{method:'POST',headers:reqHeaders});if(r.ok)updateUI(await r.json());btn.classList.remove('btn-loading');}
function showTab(n){document.querySelectorAll('.tab-content').forEach(t=>t.classList.add('hidden'));document.getElementById('tab-'+n).classList.remove('hidden');document.querySelectorAll('nav button').forEach(b=>b.classList.remove('nav-active'));document.getElementById('nav-'+n).classList.add('nav-active');loadHero();}
function toggleAccordion(c,i){const el=document.getElementById(c),ic=document.getElementById(i),o=el.style.maxHeight&&el.style.maxHeight!=='0px';document.querySelectorAll('.accordion-content').forEach(a=>a.style.maxHeight='0px');if(!o){el.style.maxHeight=el.scrollHeight+"px";ic.classList.add('rotate-180');}else ic.classList.remove('rotate-180');}
function openEditor(){document.getElementById('editor-modal').classList.remove('hidden');}
function closeEditor(){document.getElementById('editor-modal').classList.add('hidden');}
loadHero();
</script>
</body>
</html>
