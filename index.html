<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Life RPG</title>
<script src="https://cdn.tailwindcss.com"></script><script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
body{font-family:'Inter',sans-serif;background:#0c1017;color:#f0f6fc;padding:1rem;padding-bottom:7rem}
.prosto-card{background:#161b22;border:1px solid rgba(255,255,255,0.05);border-radius:1.5rem}
.prosto-btn{background:#2563eb;color:#fff;border-radius:1rem;transition:all .2s;width:100%;font-weight:700;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;cursor:pointer}
.nav-active{color:#3b82f6;background:rgba(255,255,255,0.05)}
.btn-loading{opacity:.5;pointer-events:none}.sleep-active{background:#1e3a8a!important;animation:pulse 2s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(37,99,235,.4)}70%{box-shadow:0 0 0 10px rgba(37,99,235,0)}100%{box-shadow:0 0 0 0 rgba(37,99,235,0)}}
#splash-screen{position:fixed;inset:0;background:#0c1017;z-index:9999;display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>
<div id="splash-screen"><p class="text-blue-500 font-bold animate-pulse">–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø...</p></div>
<div class="flex justify-between items-center mb-6"><div class="flex items-center gap-3"><div id="avatar" class="w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center font-bold text-xl">–ê</div><div><h1 id="user-name" class="text-lg font-bold">...</h1><div class="flex items-center gap-2"><p class="text-xs text-gray-400">XP: <span id="total-xp">0</span></p></div></div></div><div class="text-right"><div class="text-[10px] text-gray-400 font-bold">HP <span id="user-hp">100</span>%</div><div class="w-20 bg-[#161b22] h-1 rounded-full overflow-hidden mt-1"><div id="hp-bar" class="bg-blue-500 h-full w-full"></div></div></div></div>
<div id="tab-tasks" class="tab-content space-y-4">
<div class="prosto-card p-6 text-center"><p class="text-gray-400 text-[10px] uppercase font-bold">–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ</p><h2 id="month-xp" class="text-5xl font-black">0</h2></div>
<div class="grid grid-cols-2 gap-3">
<div class="prosto-card p-4"><div class="flex justify-between items-center mb-2"><span class="text-blue-400 text-[9px] font-bold">–í–û–î–ê</span><span id="water-text" class="text-[10px] font-bold">0/8</span></div><button onclick="drinkWater(this)" class="prosto-btn h-20 shadow-lg"><span>üíß</span><span class="text-[10px]">–ü–ò–¢–¨</span></button></div>
<div class="prosto-card p-4"><div class="flex justify-between items-center mb-2"><span class="text-indigo-400 text-[9px] font-bold">–°–û–ù</span><span id="sleep-status" class="text-[9px] font-bold">OFF</span></div><button id="btn-sleep" onclick="toggleSleep(this)" class="prosto-btn h-20 shadow-lg"><span id="sleep-icon">üåô</span><span id="sleep-btn-text" class="text-[10px]">–£–°–ù–£–¢–¨</span></button></div>
</div>
<button onclick="openEditor()" class="w-full text-[10px] text-gray-500 font-bold uppercase underline mt-4">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ø–∏—Å–∫–∏</button></div>
<div id="tab-calc" class="tab-content hidden space-y-4"><h2 class="text-2xl font-black text-center mt-4">–ë–∏–æ–º–µ—Ç—Ä–∏—è</h2><div class="prosto-card p-6 space-y-4"><input type="number" id="calc-h" class="w-full bg-[#0c1017] border border-gray-800 rounded-xl p-4 text-white" placeholder="–†–æ—Å—Ç (—Å–º)"><input type="number" id="calc-w" class="w-full bg-[#0c1017] border border-gray-800 rounded-xl p-4 text-white" placeholder="–í–µ—Å (–∫–≥)"><div id="bmi-res" class="hidden bg-blue-900/20 p-4 rounded-xl text-sm font-bold text-blue-400"></div><button onclick="applyWaterGoal(this)" class="prosto-btn p-4">–°–û–•–†–ê–ù–ò–¢–¨ –¶–ï–õ–¨</button></div></div>
<div id="tab-shop" class="tab-content hidden p-4"></div><div id="tab-history" class="tab-content hidden p-4"></div>
<nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-md bg-[#161b22]/95 backdrop-blur-xl border border-gray-800 rounded-[2rem] p-2 flex justify-around shadow-2xl z-50">
<button onclick="showTab('tasks')" id="nav-tasks" class="flex-1 py-3 rounded-2xl nav-active text-[9px] font-black">–ü–£–¢–¨</button><button onclick="showTab('calc')" id="nav-calc" class="flex-1 py-3 rounded-2xl text-gray-500 text-[9px] font-black">–ë–ò–û</button><button onclick="showTab('shop')" id="nav-shop" class="flex-1 py-3 rounded-2xl text-gray-500 text-[9px] font-black">–ú–ê–ì</button><button onclick="showTab('history')" id="nav-history" class="flex-1 py-3 rounded-2xl text-gray-500 text-[9px] font-black">–ñ–£–†</button></nav>
<script>
const tg=window.Telegram.WebApp;tg.expand();const backendUrl="https://rpg-backend-yg16.onrender.com";const userId=tg.initDataUnsafe?.user?.id.toString()||"guest";const reqHeaders={'Content-Type':'application/json','X-TG-Data':tg.initData||""};
function updateUI(d){if(!d)return;document.getElementById('total-xp').textContent=d.xp;document.getElementById('month-xp').textContent=d.mxp;document.getElementById('user-hp').textContent=d.hp;document.getElementById('hp-bar').style.width=d.hp+'%';document.getElementById('water-text').textContent=`${d.wc}/${d.wg}`;
const sB=document.getElementById('btn-sleep'),sI=document.getElementById('sleep-icon'),sT=document.getElementById('sleep-btn-text'),sS=document.getElementById('sleep-status');
if(d.ss){sB.classList.add('sleep-active');sI.textContent='‚òÄÔ∏è';sT.textContent='–ü–†–û–°–ù–£–¢–¨–°–Ø';const dt=new Date(d.ss);sS.textContent=`C ${String(dt.getHours()).padStart(2,'0')}:${String(dt.getMinutes()).padStart(2,'0')}`;}else{sB.classList.remove('sleep-active');sI.textContent='üåô';sT.textContent='–£–°–ù–£–¢–¨';sS.textContent='OFF';}
document.getElementById('splash-screen').style.display='none';}
async function applyWaterGoal(btn){const w=document.getElementById('calc-w').value;if(w>0){btn.classList.add('btn-loading');const g=Math.ceil((w*40)/250);const r=await fetch(`${backendUrl}/set_water_goal/${userId}?goal=${g}`,{method:'POST',headers:reqHeaders});if(r.ok)updateUI(await r.json());btn.classList.remove('btn-loading');}}
async function toggleSleep(btn){btn.classList.add('btn-loading');try{const r=await fetch(`${backendUrl}/sleep_action/${userId}`,{method:'POST',headers:reqHeaders});if(r.ok)updateUI(await r.json());else tg.showAlert("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");}finally{btn.classList.remove('btn-loading');}}
async function drinkWater(btn){btn.classList.add('btn-loading');try{const r=await fetch(`${backendUrl}/drink_water/${userId}`,{method:'POST',headers:reqHeaders});if(r.ok)updateUI(await r.json());}finally{btn.classList.remove('btn-loading');}}
async function loadHero(){try{const r=await fetch(`${backendUrl}/get_hero/${userId}`,{headers:reqHeaders});if(r.ok)updateUI(await r.json());}catch(e){}}
function showTab(n){document.querySelectorAll('.tab-content').forEach(t=>t.classList.add('hidden'));document.getElementById('tab-'+n).classList.remove('hidden');document.querySelectorAll('nav button').forEach(b=>b.classList.remove('nav-active'));document.getElementById('nav-'+n).classList.add('nav-active');loadHero();}
loadHero();
</script>
</body>
</html>
